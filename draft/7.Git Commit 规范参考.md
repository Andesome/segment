# Git Commit 规范参考
## 场景
在github上逛逛就可以发现，其提交的Commit都是有一定格式的，工作中也有相应的规定，时间长了就能体会到其中的好处。这种约束没有说什么国际标准，是一种良好的实践。抽出一些时间，更详细的了解相关的资料，然后做了一些实践和总结。

## 规范Commit的好处
1. 提供更明确的历史信息，方便判断提交目的和浏览。随着提交越来越多，便捷的感觉会越来越明显
2. 可以过滤某些不必要的提交，方便快速查找信息
3. 自动化生成Change log
4. 向同事、公众与其他利益关系人传达变化的性质
5. 基于提交的类型，自动决定语义化的版本变更

以上的好处，个人认为要有一个大的前提，就是每一个提交，尽量保证其目的单一性，比如说几个bug看似类似，就一次性修改提交。这样做，让Commit的信息变的复杂化，阅读不方便，也容易让人想到一些不必要的关联性。


## Commit 的格式
先找几个start较多的库，看看提交的格式。
- [react-commit](https://github.com/facebook/react/commits/master)

![react-commit](../images/7/react-commit.png)

- [vuejs-commit](https://github.com/vuejs/vue/commits/dev)

![vuejs-commit](../images/7/vuejs-commit.png)

- [angular-commit](https://github.com/angular/angular/commits/master)

![angular-commit](../images/7/angular-commit.png)

## Commit 相关的工具
### 提示的工具 [commitizen](https://github.com/commitizen/cz-cli)
这个工具是用来给commit一个引导的作用，根据提交填写的信息会自动划分到一种类型提交。
在window环境下安装，个人遇到的问题有：
#### 1、安装 commitizen 后，进行初始化，找不到命令

![7-failed1](../images/7/failed1.png)

尝试成功的解决方法是用 yarn 执行指令:
```sh
yarn commitizen init cz-conventional-changelog --save-dev --save-exact
```

#### 2、按照说明里面直接执行 `npx git-cz`无效，安装了 npx 也无效

发现在 `node_modules\bin\` 目录下，并没有`npx`相关可执行文件,需要安装 npx。

安装后还是无效，需要用 yarn 来执行指令
```sh
yarn npx git-cz
```

![7-npx](../images/7/npx.png)

可以发现执行指令后，去到了对应的可执行文件的路径。

如果配置了 scripts，那么提交的时候需要执行对应的指令，才会触发这个工具的作用。

还有操作的问题，在自己的戴尔笔记本用上下键切换无效，也尝试过各种组合键，也是无效，外接的键盘有效。
#### 提交校验工具 [commitlint](https://github.com/marionebl/commitlint)
原[validate-commit-msg](https://github.com/conventional-changelog-archived-repos/validate-commit-msg)已不被推荐使用。安装对应要使用的提交规范，
```sh
#it also works for Windows
yarn add @commitlint/{config-conventional,cli} --dev

# Configure commitlint to use angular config
echo "module.exports = {extends: ['@commitlint/config-conventional']}" > commitlint.config.js
```

示例用的是 `config-conventional` 规范，这个安装后，还需要使用'commitmsg' hook，推荐使用[husky](https://github.com/typicode/husky/tree/master)。安装husky
```sh
yarn add husky --dev
```
然后配置package.json
```json
{
  "scripts": {
    "commitmsg": "commitlint -E GIT_PARAMS"
  }
}
```
提交时候的效果如下图。

![7-validate-commit](../images/7/validate-commit.png)

#### 生成 Change log
使用的工具是[Conventional Changelog](https://github.com/conventional-changelog)，推荐使用 [standard-version](https://github.com/conventional-changelog/standard-version)。commit 符合[Conventional Commits Specification](https://conventionalcommits.org/)中描述的格式，就可以用程序自动生成Change log。

先进行安装。
```sh
yarn add standard-version --dev
```
然后配置package.json配置执行的脚本。
```json
{
  "scripts": {
    "release": "standard-version"
  }
}
```
执行该脚本命令，产生的结果：生成文件CHANGELOG.md、自动修改库的版本号，产生一个commit，用工具查看如下图所示。

![7-changelog](../images/7/changelog.png)

每一次执行，不会覆盖之前的change log，只会在CHANGELOG.md的顶部添加新的内容。

## 给自己的提交规范

## 参考资料
- [Conventional Commits 1.0.0-beta.2](https://conventionalcommits.org/)
- [Git Commit Guidelines](https://github.com/angular/angular.js/blob/master/DEVELOPERS.md#commits)
- [Commit message 和 Change log 编写指南](http://www.ruanyifeng.com/blog/2016/01/commit_message_change_log.html)
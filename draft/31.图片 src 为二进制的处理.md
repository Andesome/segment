# 30.图片 src 为二进制的处理
## <a name="situation"></a> 场景
请求一张合成图片，返回的数据类型是二进制，要将图片显示出来。

## 图片 src 为二进制的处理
这种场景下，首先想到的是图片的 src 为 base64 的情况，了解 [Base64][url-segment-30] 后，理论上可行。查询资料，发现了类似的[问题1][url-stackoverflow-ques1]和[问题2][url-stackoverflow-ques1]，解决的方法有：
1. 使用 URL.createObjectURL() 方法。
2. 使用 window.btoa() 方法。
3. 使用 FileReader 对象 readAsDataURL() 方法。

下面进行实际的测试。
### URL.createObjectURL()
[URL][url-mdn-url] 对象是用来解析、构造、规范和编码 [URLs][url-mdn-urls]（统一资源定位符）。它有两个静态方法：
- URL.createObjectURL()：创建一个 DOMString，其中包含一个表示参数中给出的对象的URL。这个 URL 的生命周期和创建它的窗口中的 document 绑定。这个新的URL 对象表示指定的 File 对象或 [Blob][url-mdn-blob] 对象。
- URL.revokeObjectURL() ：释放一个之前通过调用 URL.createObjectURL() 创建的已经存在的 URL 对象。浏览器在文档退出的时候会自动释放它们，但为了获得最佳性能和内存使用状况，当你结束使用某个 URL 对象时，应该通过调用这个方法来让浏览器知道不再需要保持这个文件的引用了。

这是测试[示例][]，扫描二维码访问如下。

方法可行。关于兼容性如下：

### window.btoa()
`window.btoa()` 方法从 String 对象中创建一个 base-64 编码的 ASCII 字符串，其中字符串中的每个字符都被视为一个二进制数据字节。

与其对应的方法是 `window.atob()`，对用 base-64 编码过的字符串进行解码。

这是测试[示例][]，扫描二维码访问如下。

结果出现了 `InvalidCharacterError` 异常，方法不可行。

这个方法的使用场景之一：使用此方法对可能导致通信问题的数据进行编码、传输，然后使用 `atob()` 方法再次对数据进行解码。

### readAsDataURL()
[FileReader][url-mdn-file-reader] 对象允许 Web 应用程序异步读取存储在用户计算机上的文件（或原始数据缓冲区）的内容，使用 File 或 Blob 对象指定要读取的文件或数据。其拥有的方法 `readAsDataURL()`，开始读取指定的Blob中的内容。一旦完成，result 属性中将包含一个 data: URL格式的字符串以表示所读取文件的内容。

这是测试[示例][]，扫描二维码访问如下。

方法可行。关于兼容性如下：

## <a name="reference"></a> 参考资料
- [btoa][url-mdn-btoa]


[url-stackoverflow-ques1]:https://stackoverflow.com/questions/10982712/convert-binary-data-to-base64-with-javascript
[url-stackoverflow-ques2]:https://stackoverflow.com/questions/19672685/setting-binary-data-on-img
[url-mdn-blob]:https://developer.mozilla.org/zh-CN/docs/Web/API/Blob
[url-mdn-atob]:https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/atob
[url-mdn-btoa]:https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/btoa
[url-standard-file]:https://w3c.github.io/FileAPI/#blob-section
[url-mdn-url]:https://developer.mozilla.org/en-US/docs/Web/API/URL
[url-mdn-urls]:https://developer.mozilla.org/en-US/docs/Learn/Common_questions/What_is_a_URL
[url-mdn-file-reader]:https://developer.mozilla.org/en-US/docs/Web/API/FileReader

[url-blog1]:https://www.jianshu.com/p/b2c6dc5fad0a

[url-segment-30]:https://github.com/XXHolic/segment/issues/32
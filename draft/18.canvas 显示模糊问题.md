# canvas 显示模糊问题
## <a name="situation"></a> 场景
这是继 [canvas 宽高问题][url-segment-17] 之后碰到的第二个问题。

## 显示模糊问题
在 PC 浏览器上显示没有发现有明显的模糊，还可以接受，但在手机上就会有明显的模糊。这是[示例][]，扫访问二维码如下。

### 原因
在 stackoverflow 上也找到相关的[问题][url-stackoverflow1]，在回答中有相关介绍的文章[HTML5 Rocks][url-blog1]。原因是 canvas 绘制时独立于设置像素比（devicePixelRatio）。受到手机 devicePixelRatio 影响，在高清手机显示屏上，一个逻辑像素对应多个实际的设备物理像素。例如在 devicePixelRatio 为 2 的设备上，css 设置的 100px，意味着设备上要填充 200px 物理像素，那么当 canvas 绘制 100px 的区域时，实际是想在设备填充 100px 物理像素，但由于 devicePixelRatio 的作用，设备要求显示 200px 的物理像素，浏览器就智能的填充了像素之间的空格，以便以适当的大小显示元素。

在 Safari6 中支持一个属性 backingStorePixelRatio，该属性决定了浏览器在渲染 canvas 会用几个像素来绘制画布的信息。有些类似于 devicePixelRatio。Safari6 的值为 2，所以在 Safari6 中 canvas 不会模糊，但后来去掉了，现在浏览器不支持这个属性，具体见 [
Issue 277205][url-Issue]。

### 解决方法
解决的思路就是通过检测设备像素比，绘制对应比例的 canvas 元素。

## 参考资料
- [The canvas element][url-spec-canvas]
- [How do I fix blurry text in my HTML5 canvas?][url-stackoverflow1]
- [Why context2d.backingStorePixelRatio deprecated?][url-stackoverflow2]

[url-repository-images]:https://xxholic.github.io/segment/images

[url-segment-17]:https://github.com/XXHolic/segment/issues/19
[url-stackoverflow1]:https://stackoverflow.com/questions/15661339/how-do-i-fix-blurry-text-in-my-html5-canvas
[url-stackoverflow2]:https://stackoverflow.com/questions/15661339/how-do-i-fix-blurry-text-in-my-html5-canvas
[url-blog1]:https://www.html5rocks.com/en/tutorials/canvas/hidpi/
[url-Issue]:https://bugs.chromium.org/p/chromium/issues/detail?id=277205#c19





[url-local-canvas-unit]:../images/17/qrcode-canvas-unit.png
[url-local-canvas-css]:../images/17/qrcode-canvas-css.png
# JavaScript 新旧替换一：变量
## <a name="index"></a> 目录
- [场景](#situation)
- [变量声明](#style)
  - [变量类型](#link)
  - [变量声明](#link)
- [参考资料](#reference)



## <a name="situation"></a> 场景
在工作中，最初接触 ES5 的语法比较多，后来渐渐的接触了新的语法。由于历史原因，需要在不同的项目使用不同的语法。时间长了，发现在写代码的时候，偏向用更加熟悉的旧语法，但感觉这么下去不太妙。于是，就想着针对工作中常用的语法，用新的进行对比替换，然后记录总结一下，有意识的更新相关知识点。以下参考版本：ECMA-262, 9th edition, June 2018。

## 变量声明
### ES5
在 ECMAScript 中，变量可以用来保存任何类型的数据。每个变量只是一个用于保存值的占位符而已。在 ES5 中，使用 var 声明变量，这种声明方式的特点有：
1. 声明的变量不赋值，会初始化默认值为 `undefined`。
```javascript
var testVariable;
console.info('testVariable=',testVariable); // undefined
```
2. 可以一条语句定义多个变量，变量之间用董浩分开即可。
```javascript
var name = 'Tom',
    age = 15;
```
3. 如果省略 `var` 声明，则会创建一个全局变量，这样会污染全局变量，这种方式不推荐。
4. 用 `var` 声明的变量会自动添加到最近的环境中，当查找变量的时候，搜索过程是从作用域链的前端开始，向上逐级查询。如果在局部环境中找到了变量，则停止搜索，使用找到的变量。5. 用 `var` 声明的变量会自动添加到最近的环境中，当查找变量的时候，搜索过程是从作用域链的前端开始，向上逐级查询。如果在局部环境中找到了变量，则停止搜索，使用找到的变量。
5. 同一作用域内重复声明同一变量时，后声明会覆盖前声明。
```javascript
var testVariable = '123';
var testVariable = '12';
console.info('testVariable=',testVariable); //12
```
6. 声明的变量会发生“变量提升”，也就是说可以声明先使用，这种方式不推荐。
```javascript
console.info('testVariable=',testVariable); // undefined
var testVariable = 1;
```


使用 `var` 声明比较经典的现象是在 `for` 循环语句中。
```javascript
function printNum() {
  var numArray = [];
  for(var i=0;i<5;i++) {
    numArray.push(function (){
      console.info(i);
    })
  }
  numArray[0]();
}
printNum(); // 5
```
for 循环中用 var 声明的变量 i 在函数 printNum 作用域中都有效，每次循环执行语句 `console.info(i)` 中的 i 和 for 循环中声明的 i，指向的是同一个 i，执行完最后一次循环，i 的值就是 5。

### ES2015+
新增的声明变量方式有：let const。
#### let 声明
用法跟 var 类似，这种方式不同的地方有：
1. 声明的变量，在 let 所在的代码块内有效。
```javascript
{
  let testLet = 1;
  var testVar = 2;
}
console.info('testVar=',testVar); // 2
console.info('testLet=',testLet); // Uncaught ReferenceError: testLet is not defined
```
2. 不会“变量提升”，要先声明后使用，否则会报错。
```javascript
console.info('testLet=',testLet); // Uncaught ReferenceError: testLet is not defined
let testLet = 1;
```
这种过早访问 let 声明的引用导致的 ReferenceError 严格说叫做“暂时死亡区”（Temporal Dead Zone，TDZ）错误。这种情况下，使用 `typeof` 就会有问题。
```javascript
console.info(typeof testVar);
console.info(typeof testLet);
var testVar = '123';
var testLet = 123; // Uncaught ReferenceError: testLet is not defined
```
3. 同一作用域内，不允许重复声明同一个变量。
```javascript
let testLet = 1;
let testLet = '123'; // Uncaught SyntaxError: Identifier 'testLet' has already been declared
```







## <a name="reference"></a> 参考资料
[ECMA 9th][url-ecma-9th]
[ECMAScript 6 入门][url-es6-ruanyifeng]


[url-ecma-9th]:http://www.ecma-international.org/ecma-262/9.0/index.html#sec-intro
[url-es6-ruanyifeng]:http://es6.ruanyifeng.com/




[url-mdn-immediately-function]:https://developer.mozilla.org/en-US/docs/Glossary/IIFE
[url-wiki-immediately-function]:https://en.wikipedia.org/wiki/Immediately_invoked_function_expression
[url-blog-immediately-function]:http://benalman.com/news/2010/11/immediately-invoked-function-expression/#iife